# üåü **SQLWithIDC ‚Äì Day 15 Challenge**

## üß© **Challenge Question**

Create a comprehensive service analysis report for week 20 showing: service name, total patients admitted that week, 
total patients refused,average patient satisfaction,count of staff assigned to service, 
and count of staff present that week.Order by patients admitted descending.

## üíª **SQL Query**

SELECT sw.service, 
SUM(sw.patients_admitted) AS total_admitted, 
SUM(sw.patients_refused) AS total_refused,
ROUND(AVG(sw.patient_satisfaction), 2) AS avg_satisfaction,
COUNT(DISTINCT s.staff_id) AS total_staff,
SUM(CASE WHEN ss.present = 1 THEN 1 ELSE 0 END) AS staff_present
FROM services_weekly sw
LEFT JOIN staff s ON sw.service = s.service
LEFT JOIN staff_schedule ss ON s.staff_id = ss.staff_id 
AND ss.week = sw.week
WHERE sw.week = 20
GROUP BY sw.service
ORDER BY total_admitted DESC;

## üß† **Explanation**
* `LEFT JOIN staff` ‚Üí Brings staff for each service, even if few or none exist.
* `LEFT JOIN staff_schedule` ‚Üí Gets presence for **week 20** only.
* `SUM(sw.patients_admitted)` ‚Üí Total patients admitted that week.
* `SUM(sw.patients_refused)` ‚Üí Total refused that week.
* `AVG(sw.patient_satisfaction)` ‚Üí Average satisfaction for week 20.
* `COUNT(DISTINCT s.staff_id)` ‚Üí Number of staff assigned to the service.
* `SUM(CASE WHEN present = 1 THEN 1 END)` ‚Üí Staff who actually worked that week.
* `ORDER BY total_admitted DESC` ‚Üí Services with highest admissions show first.


## üìò **Practice Questions**
### 1Ô∏è‚É£ Join patients, staff, and staff_schedule to show patient service and staff availability.

SELECT p.patient_id,p.name AS patient_name,p.service,s.staff_id,s.staff_name,s.role,ss.present,ss.week
FROM patients p LEFT JOIN staff s ON p.service = s.service
LEFT JOIN staff_schedule ss ON s.staff_id = ss.staff_id;

### 2Ô∏è‚É£ Combine services_weekly with staff and staff_schedule for comprehensive service analysis.

SELECT sw.week, sw.service, sw.patients_admitted, sw.patients_refused,sw.staff_morale, s.staff_id, s.staff_name,s.role,
ss.week AS schedule_week, ss.present FROM services_weekly sw
LEFT JOIN staff s ON sw.service = s.service
LEFT JOIN staff_schedule ss ON s.staff_id = ss.staff_id;

### 3Ô∏è‚É£ Create a multi-table report showing patient admissions with staff information.

SELECT p.patient_id, p.name AS patient_name, p.service, sw.patients_admitted, s.staff_id, s.staff_name
FROM patients p
LEFT JOIN services_weekly sw ON p.service = sw.service
LEFT JOIN staff s ON p.service = s.service;

## üôå **Acknowledgement**
Thanks to **@DPDzero** and **@IndianDataClub** for inspiring another great day of **#SQLWithIDC** learning!
